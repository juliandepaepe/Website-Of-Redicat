<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Redicat — Account</title>
  <meta name="description" content="Create an account or log in to Redicat." />
  <meta name="theme-color" content="#0b0d10" />
  <style>
    :root{--bg:#0b0d10;--card:#12151a;--text:#e6e9ef;--muted:#a3adbb;--brand1:#4f8cff;--brand2:#8a5cff}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#0b0d10,#0e1014);color:var(--text)}
    .container{max-width:980px;margin:0 auto;padding:0 1rem}
    header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(180%) blur(10px);background:rgba(11,13,16,.7);border-bottom:1px solid rgba(255,255,255,.06)}
    .nav{display:flex;align-items:center;justify-content:space-between;min-height:64px;gap:.75rem;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:.6rem;color:var(--text);text-decoration:none;font-weight:700}
    .brand svg{width:34px;height:34px}
    .nav-links{display:flex;gap:.6rem;align-items:center}
    .nav-links a{color:var(--muted);text-decoration:none;padding:.5rem .75rem;border-radius:.6rem}
    .nav-links a:hover{color:var(--text);background:rgba(255,255,255,.06)}
    .nav-links .active{color:var(--text);background:linear-gradient(135deg, rgba(79,140,255,.2), rgba(138,92,255,.2))}
    main{padding:2.5rem 0}
    h1{font-size:clamp(2rem,4vw,3rem);margin:.2rem 0}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem;margin-top:1rem}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:1rem;padding:1.25rem}
    label{display:block;margin:.5rem 0 .25rem}
    input{width:100%;padding:.6rem .7rem;border-radius:.6rem;border:1px solid rgba(255,255,255,.15);background:#0f1217;color:var(--text)}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:.7rem 1rem;border-radius:.8rem;border:0;background:linear-gradient(90deg,var(--brand1),var(--brand2));color:white;font-weight:600;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,.15);color:var(--text)}
    .row{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.75rem}
    .alert{padding:.75rem 1rem;border-radius:.8rem;border:1px solid rgba(255,255,255,.12);background:#151922;margin:.75rem 0}
    .ok{border-color:rgba(70,200,140,.35)}
    .err{border-color:rgba(240,90,90,.45)}
    footer{border-top:1px solid rgba(255,255,255,.08);}
    footer .container{padding:1.25rem 1rem}
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="/" aria-label="Home">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" role="img" aria-label="Logo"><defs><linearGradient id="g" x1="0" x2="1"><stop offset="0%" stop-color="#4f8cff"/><stop offset="100%" stop-color="#8a5cff"/></linearGradient></defs><rect width="64" height="64" rx="14" fill="#0f131a"/><circle cx="32" cy="32" r="24" fill="url(#g)" opacity=".25"/><path d="M18 40 L28 20 L36 20 L28 44 L18 44 Z M34 44 L46 44 L46 38 L40 38 L43 30 L37 30 L34 44 Z" fill="#e6e9ef"/></svg>
        <span>Redicat</span>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/">Home</a>
        <a href="/account" class="active" aria-current="page">Account</a>
        <a href="/socials.html">Socials</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h1>Redicat</h1>
      <p class="muted">Create an account or log in — now with Google and Microsoft.</p>
      <div id="status" class="alert"></div>

      <div class="grid">
        <div class="card">
          <h2>Email & password</h2>
          <label for="signupName">Username</label>
          <input id="signupName" placeholder="Your display name" />
          <label for="signupEmail">Email</label>
          <input id="signupEmail" placeholder="you@example.com" type="email" />
          <label for="signupPass">Password</label>
          <input id="signupPass" type="password" />
          <div class="row"><button class="btn" id="btnCreate">Create account</button></div>

          <hr style="margin:1rem 0;border-color:rgba(255,255,255,.08)" />

          <label for="loginEmail">Email</label>
          <input id="loginEmail" placeholder="you@example.com" type="email" />
          <label for="loginPass">Password</label>
          <input id="loginPass" type="password" />
          <div class="row"><button class="btn" id="btnLogin">Log in</button></div>
        </div>

        <div class="card">
          <h2>Or continue with</h2>
          <div class="row"><button class="btn secondary" id="btnGoogle">Google</button></div>
          <div class="row"><button class="btn secondary" id="btnMicrosoft">Microsoft</button></div>
        </div>

        <div class="card" id="acct"><h2>Account status</h2><p class="muted" id="acctState">No user signed in.</p><div class="row"><button class="btn secondary" id="btnRefresh">Refresh status</button><button class="btn secondary" id="btnLogout">Log out</button></div></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container"><small>© 2025 Julian Lorenzo Depaepe · Built with HTML5</small></div>
  </footer>

<script>
(function(){
  const $ = (s, r=document) => r.querySelector(s);
  const set = (text, cls='') => { const el=$('#status'); el.className='alert '+cls; el.textContent=text; };

  async function getFirebaseConfig(){
    try {
      const r = await fetch('/api/firebase-config', { cache: 'no-store' });
      if (!r.ok) throw new Error('Config fetch failed: '+r.status);
      return await r.json();
    } catch(e){
      try { const raw = localStorage.getItem('firebase_config_v1'); if (raw) return JSON.parse(raw); } catch(_){ }
      throw e;
    }
  }

  async function init(){
    try {
      const cfg = await getFirebaseConfig();
      const app = firebase.apps?.length ? firebase.app() : firebase.initializeApp(cfg);
      const auth = firebase.auth(app);

      const updateState = () => {
        const u = auth.currentUser;
        $('#acctState').textContent = u ? `Signed in as ${u.email || u.displayName || u.uid}` : 'No user signed in.';
      };

      $('#btnCreate').onclick = async () => {
        set('Creating account...');
        try {
          const name = $('#signupName').value.trim();
          const email = $('#signupEmail').value.trim();
          const pass = $('#signupPass').value;
          const { user } = await auth.createUserWithEmailAndPassword(email, pass);
          if (name) await user.updateProfile({ displayName: name });
          try { await user.sendEmailVerification(); } catch {}
          set('Account created. Check your email for verification.', 'ok');
          updateState();
        } catch(err){ set('Error: '+err.message, 'err'); }
      };

      $('#btnLogin').onclick = async () => {
        set('Signing in...');
        try {
          const email = $('#loginEmail').value.trim();
          const pass = $('#loginPass').value;
          await auth.signInWithEmailAndPassword(email, pass);
          set('Signed in.', 'ok');
          updateState();
        } catch(err){ set('Firebase: '+err.message, 'err'); }
      };

      $('#btnGoogle').onclick = async () => {
        set('Opening Google...');
        try {
          const provider = new firebase.auth.GoogleAuthProvider();
          await auth.signInWithPopup(provider);
          set('Signed in with Google.', 'ok');
          updateState();
        } catch(err){ set('Firebase: '+err.message, 'err'); }
      };

      $('#btnMicrosoft').onclick = async () => {
        set('Opening Microsoft...');
        try {
          const provider = new firebase.auth.OAuthProvider('microsoft.com');
          provider.setCustomParameters({ prompt: 'select_account' });
          await auth.signInWithPopup(provider);
          set('Signed in with Microsoft.', 'ok');
          updateState();
        } catch(err){ set('Firebase: '+err.message, 'err'); }
      };

      $('#btnLogout').onclick = async () => { await auth.signOut(); updateState(); set('Logged out.', 'ok'); };
      $('#btnRefresh').onclick = async () => { try { if (auth.currentUser) await auth.currentUser.reload(); } catch{} updateState(); };

      auth.onAuthStateChanged(() => updateState());
      set('Ready. You can create an account or log in.', 'ok');
      updateState();
    } catch(e){
      console.error(e);
      set('Failed to load Firebase configuration. Ensure /api/firebase-config is deployed and env vars are set.', 'err');
    }
  }

  init();
})();
</script>
</body>
</html>
