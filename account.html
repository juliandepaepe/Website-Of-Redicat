<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Redicat — Account</title>
  <meta name="description" content="Create account / Log in with email verification, Google and Microsoft sign-in." />
  <meta name="theme-color" content="#0b0d10" />
  <style>
    :root{--bg:#0b0d10;--card:#12151a;--text:#e6e9ef;--muted:#a3adbb;--brand:#4f8cff;--brand2:#8a5cff;--ok:#46d27d;--warn:#ffc54d;--err:#ff6b6b}
    *{box-sizing:border-box} html{scroll-behavior:smooth}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#0b0d10,#0e1014);color:var(--text)}
    .container{max-width:1000px;margin:0 auto;padding:0 1rem}
    header{position:sticky;top:0;z-index:20;backdrop-filter:saturate(180%) blur(10px);background:rgba(11,13,16,.7);border-bottom:1px solid rgba(255,255,255,.06)}
    .nav{display:flex;align-items:center;justify-content:space-between;min-height:64px;gap:.75rem;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:.6rem;color:var(--text);text-decoration:none;font-weight:700}
    .brand svg{width:34px;height:34px}
    .nav-links{display:flex;gap:.5rem;align-items:center}
    .link,.btn-link{color:var(--muted);text-decoration:none;padding:.5rem .75rem;border-radius:.6rem;border:1px solid transparent;background:transparent;cursor:pointer;font:inherit}
    .link:hover,.btn-link:hover{color:var(--text);background:rgba(255,255,255,.06)}
    .active{color:var(--text);background:linear-gradient(135deg, rgba(79,140,255,.2), rgba(138,92,255,.2))}
    .hero{padding:4.5rem 0 2.25rem}
    h1{font-size:clamp(2rem,4vw,3rem);margin:.2rem 0}
    .subtitle{color:var(--muted);margin:0 0 1rem}
    .btn{display:inline-block;border:1px solid transparent;background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;padding:.7rem 1rem;border-radius:.7rem;text-decoration:none;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border-color:rgba(255,255,255,.15)}
    .btn.oauth{display:flex;align-items:center;gap:.5rem;background:#1a1f27;border:1px solid rgba(255,255,255,.12)}
    .btn.oauth svg{width:18px;height:18px}
    .section{padding:2.25rem 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem;list-style:none;padding:0;margin:0}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:1rem;padding:1rem}
    .status{padding:.75rem 1rem;border-radius:.75rem;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04)}
    .ok{border-color:rgba(70,210,125,.35);background:rgba(70,210,125,.08)}
    .warn{border-color:rgba(255,197,77,.35);background:rgba(255,255,255,.08)}
    .err{border-color:rgba(255,107,107,.35);background:rgba(255,255,255,.08)}
    footer{border-top:1px solid rgba(255,255,255,.06);background:radial-gradient(1200px 200px at 50% -30%, rgba(79,140,255,.15), transparent),radial-gradient(700px 200px at 10% -20%, rgba(138,92,255,.15), transparent)}
    footer .container{padding:1.5rem 1rem}
    .muted{color:var(--muted)}
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="/" aria-label="Home">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" role="img" aria-label="Logo">
          <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0%" stop-color="#4f8cff"/><stop offset="100%" stop-color="#8a5cff"/></linearGradient></defs>
          <rect width="64" height="64" rx="14" fill="#0f131a"/><circle cx="32" cy="32" r="24" fill="url(#g)" opacity=".25"/>
          <path d="M18 40 L28 20 L36 20 L28 44 L18 44 Z M34 44 L46 44 L46 38 L40 38 L43 30 L37 30 L34 44 Z" fill="#e6e9ef"/>
        </svg>
        <span>Redicat</span>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/" class="link active" aria-current="page">Home</a>
        <span id="userBadge" class="muted"></span>
        <button id="logoutBtn" class="btn-link hidden">Log out</button>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero container">
      <h1>Redicat</h1>
      <p class="subtitle">Create an account or log in — now with Google and Microsoft.</p>
      <div id="appStatus" class="status warn container">Connecting…</div>
    </section>

    <section class="container section">
      <ul class="grid">
        <li class="card">
          <h2>Email & password</h2>
          <div class="field"><label>Username</label><input id="su_username" type="text" autocomplete="username" placeholder="Your display name" /></div>
          <div class="field"><label>Email</label><input id="su_email" type="email" autocomplete="email" placeholder="you@example.com" /></div>
          <div class="field"><label>Password</label><input id="su_password" type="password" autocomplete="new-password" placeholder="••••••••" /></div>
          <div id="su_msg" class="note"></div>
          <div class="row">
            <button id="doSignUp" class="btn">Create account</button>
          </div>
          <hr style="margin:1rem 0;border-color:rgba(255,255,255,.08)">
          <div class="field"><label>Email</label><input id="li_email" type="email" autocomplete="email" placeholder="you@example.com" /></div>
          <div class="field"><label>Password</label><input id="li_password" type="password" autocomplete="current-password" placeholder="••••••••" /></div>
          <div id="li_msg" class="note"></div>
          <div class="row">
            <button id="doLogin" class="btn">Log in</button>
          </div>
        </li>
        <li class="card">
          <h2>Or continue with</h2>
          <div class="row">
            <button id="loginGoogle" class="btn oauth" title="Sign in with Google" aria-label="Sign in with Google">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12 c0-6.627,5.373-12,12-12c3.059,0,5.842,1.153,7.961,3.039l5.657-5.657C33.12,6.053,28.805,4,24,4C12.955,4,4,12.955,4,24 s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,16.108,18.961,13,24,13c3.059,0,5.842,1.153,7.961,3.039l5.657-5.657 C33.12,6.053,28.805,4,24,4C16.318,4,9.689,8.337,6.306,14.691z"/><path fill="#4CAF50" d="M24,44c4.743,0,9.053-1.815,12.316-4.771l-5.682-4.807C28.542,35.664,26.396,36,24,36 c-5.202,0-9.619-3.317-11.281-7.946l-6.53,5.034C9.042,39.556,15.955,44,24,44z"/><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.236-2.231,4.166-4.181,5.582c0.001,0,0.001,0,0,0l6.19,4.686 C36.271,40.089,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"/></svg>
              Google
            </button>
            <button id="loginMicrosoft" class="btn oauth" title="Sign in with Microsoft" aria-label="Sign in with Microsoft">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 23 23"><path fill="#F25022" d="M1 1h10v10H1z"/><path fill="#7FBA00" d="M12 1h10v10H12z"/><path fill="#00A4EF" d="M1 12h10v10H1z"/><path fill="#FFB900" d="M12 12h10v10H12z"/></svg>
              Microsoft
            </button>
          </div>
          <p id="oauth_msg" class="note"></p>
          <hr style="margin:1rem 0;border-color:rgba(255,255,255,.08)">
          <h3>Account status</h3>
          <div id="authInfo" class="note">No user signed in.</div>
          <div class="row">
            <button id="refreshStatus" class="btn ghost">Refresh status</button>
            <button id="resendVerification" class="btn ghost hidden">Resend verification email</button>
            <button id="logoutInline" class="btn ghost hidden">Log out</button>
          </div>
        </li>
      </ul>
    </section>
  </main>

  <footer>
    <div class="container">
      <small>© 2025 Julian Lorenzo Depaepe · Built with HTML5</small>
    </div>
  </footer>

  <script>
    const $ = (s, r=document)=>r.querySelector(s);

    const appStatus = $('#appStatus');
    const authInfo = $('#authInfo');
    const userBadge = $('#userBadge');
    const logoutBtn = $('#logoutBtn');
    const logoutInline = $('#logoutInline');
    const refreshBtn = $('#refreshStatus');
    const resendBtn = $('#resendVerification');

    const su_username = $('#su_username');
    const su_email = $('#su_email');
    const su_password = $('#su_password');
    const su_msg = $('#su_msg');

    const li_email = $('#li_email');
    const li_password = $('#li_password');
    const li_msg = $('#li_msg');

    const oauth_msg = $('#oauth_msg');

    function setStatus(msg, cls='warn') {
      appStatus.className = 'status ' + cls + ' container';
      appStatus.innerHTML = msg;
    }
    function setAuthInfo(msg) { authInfo.textContent = msg; }
    function showUser(u) {
      if (!u) {
        userBadge.textContent = '';
        logoutBtn.classList.add('hidden');
        logoutInline.classList.add('hidden');
        setAuthInfo('No user signed in.');
        return;
      }
      const v = u.emailVerified || (u.providerData && u.providerData[0] && u.providerData[0].providerId !== 'password');
      userBadge.textContent = v ? `Signed in as ${u.displayName || u.email}` : `Signed in (unverified) — ${u.email}`;
      logoutBtn.classList.remove('hidden');
      logoutInline.classList.remove('hidden');
      setAuthInfo(v ? 'Email verified or federated login.' : 'Email not verified yet.');
      resendBtn?.classList.toggle('hidden', v);
    }

    // Load config from localStorage
    const KEY = 'firebase_config_v1';
    let cfg = null;
    try { const raw = localStorage.getItem(KEY); if (raw) cfg = JSON.parse(raw); } catch {}
    if (!cfg || !cfg.apiKey || !cfg.authDomain) {
      setStatus('Missing Firebase config in this browser. Paste your JSON once on a setup-enabled page, then return here.', 'err');
    } else {
      try {
        const app = firebase.initializeApp(cfg);
        const auth = firebase.auth(app);
        auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(() => {
          setStatus('Connected. You can create an account or log in.', 'ok');
        });

        auth.onAuthStateChanged((user)=> showUser(user));

        // Email/password sign up
        document.getElementById('doSignUp')?.addEventListener('click', async () => {
          su_msg.textContent='';
          const name = su_username.value.trim();
          const email = su_email.value.trim();
          const pass = su_password.value;
          if (!name || !email || !pass) { su_msg.textContent='Please fill all fields.'; return; }
          try {
            const cred = await auth.createUserWithEmailAndPassword(email, pass);
            await cred.user.updateProfile({ displayName: name });
            await cred.user.sendEmailVerification();
            su_msg.textContent = 'Account created. Verification email sent — check your inbox.';
          } catch (e) { su_msg.textContent = e.message; }
        });

        // Email/password login
        document.getElementById('doLogin')?.addEventListener('click', async () => {
          li_msg.textContent='';
          try {
            await auth.signInWithEmailAndPassword(li_email.value.trim(), li_password.value);
          } catch (e) { li_msg.textContent = e.message; }
        });

        // Google & Microsoft providers
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        googleProvider.setCustomParameters({ prompt: 'select_account' });

        const msProvider = new firebase.auth.OAuthProvider('microsoft.com');
        msProvider.setCustomParameters({ prompt: 'select_account' });

        async function oauthSignIn(provider) {
          oauth_msg.textContent = '';
          try {
            await auth.signInWithPopup(provider);
          } catch (e) {
            if (e && e.code === 'auth/account-exists-with-different-credential') {
              oauth_msg.textContent = 'This email exists with a different sign-in method. Try the other provider or your password.';
            } else if (e && e.message) {
              oauth_msg.textContent = e.message;
            } else {
              oauth_msg.textContent = 'Sign-in failed.';
            }
          }
        }

        document.getElementById('loginGoogle')?.addEventListener('click', ()=> oauthSignIn(googleProvider));
        document.getElementById('loginMicrosoft')?.addEventListener('click', ()=> oauthSignIn(msProvider));

        // Log out
        function doLogout(){ auth.signOut().catch(()=>{}); }
        logoutBtn?.addEventListener('click', doLogout);
        logoutInline?.addEventListener('click', doLogout);

        // Resend verification
        resendBtn?.addEventListener('click', async () => {
          if (auth.currentUser) {
            try { await auth.currentUser.sendEmailVerification(); setAuthInfo('Verification email re-sent.'); }
            catch (e) { setAuthInfo('Error: ' + e.message); }
          }
        });

        // Refresh status
        refreshBtn?.addEventListener('click', async () => {
          if (auth.currentUser) {
            try { await auth.currentUser.reload(); } catch {}
            showUser(auth.currentUser);
          } else {
            setAuthInfo('No user signed in.');
          }
        });

      } catch (e) {
        setStatus('Failed to initialize Firebase: ' + e.message, 'err');
      }
    }
  </script>
</body>
</html>
